# ADR-20250517-05: GPT-4oのトークン上限対応

日付: 2025/05/17 01:15
ステータス: 承認

## コンテキスト
アプリケーションをOpenAI APIのみを使用する形に変更した際、記事生成時に400 Bad Requestエラーが発生しました。原因調査の結果、GPT-4oモデルに対して制限を超える`max_tokens`パラメータ（32000）を指定していたことが判明しました。

## 決定
以下の修正を実装します：

1. トークン上限の修正：
   - 記事生成用のmax_tokensパラメータを32000から4000に変更
   - GPT-4oの制限値（最大4096トークン）内に収まるよう調整

2. コメントの追加：
   - モデルの制限値についての情報をコメントに記載
   - 将来的な参照のための注意点を明記

## 影響
1. 修正によりAPIエラーが解消され、記事生成プロセスが正常に機能するようになる
2. 1回のAPI呼び出しで生成できるコンテンツ量が減少する
3. 当初想定していた「1章あたり10,000文字以上」の目標は単一リクエストでは達成困難になる
4. 将来的には複数リクエストの結果を組み合わせるなど、長文生成方法の改善が必要になる可能性がある

## 関連ADR
- [ADR-20250517-04](./ADR-20250517-04.md): LLM提供元の統一（全てOpenAIに）
